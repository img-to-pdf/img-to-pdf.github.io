<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image Resizer — demo</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;color:#0f1720}
    body{background:#f6f8fa;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .app{width:100%;max-width:940px;background:#fff;border-radius:12px;padding:22px;box-shadow:0 10px 30px rgba(11,37,79,0.06)}
    h1{margin:0 0 8px;font-size:20px;color:#0366d6}
    p.lead{margin:0 0 16px;color:#333}
    .controls{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .left,.right{padding:12px}
    .drop{border:2px dashed #e1e4e8;border-radius:8px;padding:18px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;background:#fbfdff}
    input[type=file]{display:none}
    .btn{display:inline-block;padding:8px 12px;background:#0366d6;color:#fff;border-radius:8px;text-decoration:none;cursor:pointer}
    label{display:block;margin-bottom:6px;font-weight:600;color:#222;font-size:13px}
    .field{margin-bottom:12px}
    .row{display:flex;gap:8px;align-items:center}
    input[type=number], select, input[type=range], .small-input{width:100%;padding:8px;border-radius:6px;border:1px solid #dfe4ea}
    .small-input{width:120px}
    canvas{max-width:100%;border-radius:8px;background:#fff}
    .preview{display:flex;flex-direction:column;gap:10px;align-items:center}
    .meta{font-size:13px;color:#555}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    footer{margin-top:14px;font-size:13px;color:#666}
    @media (max-width:900px){.controls{grid-template-columns:1fr;}.right{order:-1}}
  </style>
</head>
<body>
  <main class="app" aria-labelledby="title">
    <h1 id="title">Image Resizer</h1>
    <p class="lead">Upload an image, pick size or percent, choose format/quality, preview and download the resized image.</p>

    <div class="controls" role="region" aria-label="Image resizer controls">
      <section class="left" aria-label="Upload and options">
        <div class="drop" id="dropZone">
          <strong>Drop image here</strong>
          <span class="meta">or <label class="btn" for="fileInput" style="margin:0">Select file</label></span>
          <input id="fileInput" type="file" accept="image/*" />
        </div>

        <div style="margin-top:12px">
          <div class="field">
            <label for="mode">Resize mode</label>
            <select id="mode">
              <option value="dimensions">Exact dimensions (px)</option>
              <option value="percent">Scale by percent</option>
              <option value="fit">Fit within (max width/height)</option>
            </select>
          </div>

          <div id="dimensionsInputs" class="field">
            <div class="row">
              <div style="flex:1">
                <label for="width">Width (px)</label>
                <input id="width" type="number" min="1" class="small-input" placeholder="e.g. 800" />
              </div>
              <div style="flex:1">
                <label for="height">Height (px)</label>
                <input id="height" type="number" min="1" class="small-input" placeholder="e.g. 600" />
              </div>
            </div>
            <div style="margin-top:8px">
              <label><input id="keepAspect" type="checkbox" checked /> Keep aspect ratio</label>
            </div>
          </div>

          <div id="percentInputs" class="field" style="display:none">
            <label for="percent">Scale (%)</label>
            <input id="percent" type="range" min="1" max="200" value="100" />
            <div class="row" style="margin-top:6px"><span id="percentLabel">100%</span></div>
          </div>

          <div id="fitInputs" class="field" style="display:none">
            <div class="row">
              <div style="flex:1">
                <label for="maxWidth">Max width (px)</label>
                <input id="maxWidth" type="number" min="1" class="small-input" placeholder="e.g. 1200" />
              </div>
              <div style="flex:1">
                <label for="maxHeight">Max height (px)</label>
                <input id="maxHeight" type="number" min="1" class="small-input" placeholder="e.g. 800" />
              </div>
            </div>
          </div>

          <div class="field">
            <label for="format">Output format</label>
            <select id="format">
              <option value="image/png">PNG</option>
              <option value="image/jpeg">JPEG</option>
              <option value="image/webp">WEBP</option>
            </select>
          </div>

          <div class="field">
            <label for="quality">Quality (for JPEG/WEBP)</label>
            <input id="quality" type="range" min="0.1" max="1" step="0.05" value="0.9" />
            <div class="row" style="margin-top:6px"><span id="qualityLabel">0.90</span></div>
          </div>

          <div class="actions" style="margin-top:6px">
            <button id="resizeBtn" class="btn" disabled>Resize</button>
            <button id="resetBtn" class="btn" style="background:#6f42c1">Reset</button>
          </div>
        </div>
      </section>

      <aside class="right" aria-label="Preview">
        <div class="preview">
          <canvas id="canvas" width="640" height="360" style="display:none"></canvas>
          <img id="preview" alt="Resized preview" style="display:none;max-width:100%;border-radius:8px" />
          <div class="meta" id="origMeta" style="display:none"></div>
          <div class="meta" id="newMeta" style="display:none"></div>

          <div style="display:flex;gap:8px;margin-top:10px">
            <a id="downloadLink" class="btn" style="display:none" download>Download</a>
            <a id="openTab" class="btn" style="background:#17a2b8;display:none" target="_blank" rel="noopener">Open in tab</a>
          </div>
        </div>
      </aside>
    </div>

    <footer>Tip: For best results upload originals. This tool runs client-side — images do not leave your browser.</footer>
  </main>

  <script>
    // Elements
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const resizeBtn = document.getElementById('resizeBtn');
    const resetBtn = document.getElementById('resetBtn');
    const canvas = document.getElementById('canvas');
    const previewImg = document.getElementById('preview');
    const downloadLink = document.getElementById('downloadLink');
    const openTab = document.getElementById('openTab');
    const origMeta = document.getElementById('origMeta');
    const newMeta = document.getElementById('newMeta');

    const modeSelect = document.getElementById('mode');
    const dimensionsInputs = document.getElementById('dimensionsInputs');
    const percentInputs = document.getElementById('percentInputs');
    const fitInputs = document.getElementById('fitInputs');

    const widthInput = document.getElementById('width');
    const heightInput = document.getElementById('height');
    const keepAspect = document.getElementById('keepAspect');

    const percentRange = document.getElementById('percent');
    const percentLabel = document.getElementById('percentLabel');

    const maxWidth = document.getElementById('maxWidth');
    const maxHeight = document.getElementById('maxHeight');

    const formatSelect = document.getElementById('format');
    const qualityRange = document.getElementById('quality');
    const qualityLabel = document.getElementById('qualityLabel');

    let originalImage = null;
    let originalName = 'image';
    let origW = 0, origH = 0;

    // Helpers
    function show(el){ el.style.display = ''; }
    function hide(el){ el.style.display = 'none'; }
    function setDisabled(el, v){ el.disabled = !!v; }

    function updateModeUI(){
      const mode = modeSelect.value;
      dimensionsInputs.style.display = (mode === 'dimensions') ? '' : 'none';
      percentInputs.style.display = (mode === 'percent') ? '' : 'none';
      fitInputs.style.display = (mode === 'fit') ? '' : 'none';
    }

    modeSelect.addEventListener('change', updateModeUI);
    percentRange.addEventListener('input', () => percentLabel.textContent = percentRange.value + '%');
    qualityRange.addEventListener('input', () => qualityLabel.textContent = Number(qualityRange.value).toFixed(2));

    // Load image
    function handleFile(file){
      if(!file || !file.type.startsWith('image/')) return;
      originalName = file.name.replace(/\.[^/.]+$/, "");
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => {
          originalImage = img;
          origW = img.naturalWidth;
          origH = img.naturalHeight;
          origMeta.textContent = `Original: ${origW} × ${origH} — ${file.type} — ${(file.size/1024|0)} KB`;
          show(origMeta);
          // Pre-fill dimensions if empty
          if(!widthInput.value) widthInput.value = origW;
          if(!heightInput.value) heightInput.value = origH;
          enableControls(true);
          renderPreview(img); // show original preview
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function enableControls(enabled){
      setDisabled(resizeBtn, !enabled);
      // other inputs kept available for styling
    }

    fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

    // Drag & drop
    ['dragenter','dragover'].forEach(evt=>{
      dropZone.addEventListener(evt, (e)=>{
        e.preventDefault(); e.stopPropagation();
        dropZone.style.borderColor = '#0366d6';
      });
    });
    ['dragleave','drop'].forEach(evt=>{
      dropZone.addEventListener(evt, (e)=>{
        e.preventDefault(); e.stopPropagation();
        dropZone.style.borderColor = '#e1e4e8';
      });
    });
    dropZone.addEventListener('drop', e=>{
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if(f) handleFile(f);
    });

    // Keep aspect ratio live
    widthInput.addEventListener('input', ()=>{
      if(keepAspect.checked && originalImage){
        const w = Number(widthInput.value) || origW;
        const h = Math.round(w * origH / origW);
        heightInput.value = h;
      }
    });
    heightInput.addEventListener('input', ()=>{
      if(keepAspect.checked && originalImage){
        const h = Number(heightInput.value) || origH;
        const w = Math.round(h * origW / origH);
        widthInput.value = w;
      }
    });

    // Render preview (original or resized)
    function renderPreview(imgOrUrl){
      if(typeof imgOrUrl === 'string'){
        previewImg.src = imgOrUrl;
        show(previewImg); hide(canvas);
      } else if(imgOrUrl instanceof HTMLImageElement){
        // show original as preview image (use scaled URL)
        previewImg.src = imgOrUrl.src;
        show(previewImg); hide(canvas);
      } else {
        hide(previewImg); hide(canvas);
      }
    }

    // Resize logic
    async function resizeImage(){
      if(!originalImage) return;
      let targetW = origW, targetH = origH;
      const mode = modeSelect.value;
      if(mode === 'dimensions'){
        targetW = Math.max(1, Number(widthInput.value) || origW);
        targetH = Math.max(1, Number(heightInput.value) || Math.round(targetW * origH / origW));
      } else if(mode === 'percent'){
        const p = Number(percentRange.value) || 100;
        targetW = Math.max(1, Math.round(origW * p / 100));
        targetH = Math.max(1, Math.round(origH * p / 100));
      } else if(mode === 'fit'){
        const mw = Number(maxWidth.value) || origW;
        const mh = Number(maxHeight.value) || origH;
        const ratio = Math.min(mw / origW, mh / origH, 1);
        targetW = Math.max(1, Math.round(origW * ratio));
        targetH = Math.max(1, Math.round(origH * ratio));
      }

      // draw to canvas
      canvas.width = targetW;
      canvas.height = targetH;
      const ctx = canvas.getContext('2d');
      // optional: clear
      ctx.clearRect(0,0,targetW,targetH);
      // draw with smoothing
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(originalImage, 0, 0, targetW, targetH);

      // get blob for chosen format
      const mime = formatSelect.value || 'image/png';
      const quality = Number(qualityRange.value);
      const blob = await new Promise(resolve => {
        // toBlob handles quality for lossy formats (jpeg/webp)
        canvas.toBlob(resolve, mime, quality);
      });

      if(!blob) return alert('Failed to produce resized image.');

      const url = URL.createObjectURL(blob);
      previewImg.src = url;
      show(previewImg); hide(canvas);

      const ext = mime === 'image/png' ? 'png' : (mime === 'image/jpeg' ? 'jpg' : 'webp');
      const outName = `${originalName}-resized.${ext}`;
      downloadLink.href = url;
      downloadLink.download = outName;
      downloadLink.style.display = '';
      openTab.href = url;
      openTab.style.display = '';

      newMeta.textContent = `New: ${targetW} × ${targetH} — ${(blob.size/1024|0)} KB — ${mime}`;
      show(newMeta);

      // revoke URLs later when resetting (or user downloads)
      enableControls(true);
    }

    resizeBtn.addEventListener('click', resizeImage);

    resetBtn.addEventListener('click', ()=>{
      originalImage = null;
      originalName = 'image';
      origW = origH = 0;
      fileInput.value = '';
      previewImg.src = '';
      hide(previewImg); hide(canvas); hide(origMeta); hide(newMeta);
      downloadLink.style.display = 'none';
      openTab.style.display = 'none';
      enableControls(false);
      widthInput.value = '';
      heightInput.value = '';
      maxWidth.value = '';
      maxHeight.value = '';
      percentRange.value = 100;
      percentLabel.textContent = '100%';
    });

    // initialize
    updateModeUI();
    enableControls(false);

    // Accessibility: keyboard click on drop zone opens file dialog
    dropZone.addEventListener('click', ()=> fileInput.click());
    dropZone.tabIndex = 0;
    dropZone.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') fileInput.click(); });
  </script>
</body>
</html>
